@page "/creator/create-group"
@inject IGroupService GroupService
@inject IAuthService AuthService
@inject NavigationManager Navigation

<EditForm Model="@newGroup" OnValidSubmit="@HandleCreateGroup">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="form-group">
        <label for="groupName">Tên phòng:</label>
        <InputText id="groupName" @bind-Value="newGroup.Name"
                   class="form-control" placeholder="Nhập tên phòng" />
        <ValidationMessage For="@(() => newGroup.Name)" />
    </div>

    <div class="form-group">
        <label for="groupCode">Mã phòng (6 ký tự):</label>
        <InputText id="groupCode" @bind-Value="newGroup.Code"
                   class="form-control" placeholder="Nhập mã phòng"
                   maxlength="6" />
        <ValidationMessage For="@(() => newGroup.Code)" />
    </div>

    <button type="submit" class="btn btn-primary" disabled="@isLoading">
        @if (isLoading)
        {
            <span>Đang tạo...</span>
        }
        else
        {
            <span>Tạo Phòng</span>
        }
    </button>
</EditForm>

@code {
    private Group newGroup = new();
    private bool isLoading = false;

    private async Task HandleCreateGroup()
    {
        isLoading = true;

        var user = await AuthService.GetCurrentUserAsync();
        if (user != null)
        {
            newGroup.CreatorUsername = user.Username;
            newGroup.CreatedAt = DateTime.Now;
            newGroup.UpdatedAt = DateTime.Now;

            var result = await GroupService.CreateGroupAsync(newGroup);
            if (result)
            {
                Navigation.NavigateTo($"/creator/room/{newGroup.Id}");
            }
        }

        isLoading = false;
    }
}